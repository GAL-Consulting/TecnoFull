<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <title>Catálogo de Alarmas</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      color: #333;
    }

    /* Sección Hero */
    .hero {
      background: url("hero.png") no-repeat center center/cover;
      height: 60vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: white;
      padding: 20px;
    }

    .hero h1 {
      font-size: 2.5rem;
      background: rgba(0,0,0,0.6);
      padding: 15px 30px;
      border-radius: 10px;
    }

    /* Catálogo */
    .catalogo {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    .producto {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .producto:hover {
      transform: scale(1.03);
    }
    .producto img {
      width: 100%;
      height: 250px;
      object-fit: cover;
    }
    .producto .info {
      padding: 15px;
    }
    .producto .info h3 {
      margin: 0 0 10px;
      font-size: 1.2rem;
    }
    .producto .info p {
      font-size: 0.9rem;
      margin: 0 0 10px;
    }
    .producto .info .precio {
      font-weight: bold;
      color: #e63946;
      margin-bottom: 10px;
    }
    .producto .info a {
      display: inline-block;
      padding: 8px 15px;
      margin: 5px;
      border-radius: 5px;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .whatsapp {
      background: #25D366;
      color: white;
    }
    .email {
      background: #0078d7;
      color: white;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      background: #222;
      color: #fff;
    }


/* Navbar */
.navbar {
  background: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
}
.navbar .container {
  max-width: 1200px;
  margin: auto;
  padding: 10px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
}
.logo img {
  height: 40px;
}
.menu {
  display: flex;
  gap: 15px;
}
.menu a {
  text-decoration: none;
  color: #333;
  font-weight: bold;
  font-size: 0.95rem;
  padding: 8px 12px;
  border-radius: 5px;
  transition: background 0.2s;
}
.menu a:hover {
  background: #f0f0f0;
}
.whatsapp-btn {
  background: #25D366;
  color: white;
  padding: 8px 15px;
  border-radius: 5px;
  text-decoration: none;
  font-size: 0.9rem;
  margin-left: auto;
}
.menu-toggle {
  display: none;
  font-size: 1.5rem;
  cursor: pointer;
}

/* Responsive */
@media (max-width: 768px) {
  .menu {
    display: none;
    flex-direction: column;
    width: 100%;
    margin-top: 10px;
  }
  .menu a {
    padding: 10px;
    background: #f7f7f7;
  }
  .menu.show {
    display: flex;
  }
  .whatsapp-btn {
    margin-top: 10px;
    width: 100%;
    text-align: center;
  }
  .menu-toggle {
    display: block;
  }
}

  </style>
</head>
<body>

<!-- Navegación -->
<header class="navbar">
  <div class="container">
    <div class="logo">
      <img src="logo.png" alt="Logo Tienda de Alarmas">
    </div>
    <nav class="menu">
      <a href="#">Inicio</a>
      <a href="#">Alarmas</a>
      <a href="#">Sensores</a>
      <a href="#">Cámaras</a>
      <a href="#">Accesorios</a>
    </nav>
    <a class="whatsapp-btn" href="https://wa.me/5491112345678" target="_blank">Consultar por WhatsApp</a>
    <div class="menu-toggle" onclick="toggleMenu()">☰</div>
  </div>
</header>

  <!-- Hero -->
  <section class="hero">
    <h1>Catálogo de Alarmas y Accesorios</h1>
  </section>

  <!-- Catálogo -->
  <section class="catalogo">
    <!-- Producto 1 -->
    <div class="producto">
      <img src="alarma1.jpg" alt="Sistema de alarma básico">
      <div class="info">
        <h3>Alarma Básica</h3>
        <p>Sistema de seguridad con sensor de movimiento y control remoto.</p>
        <div class="precio">$120</div>
        <a class="whatsapp" href="https://wa.me/5491112345678" target="_blank">WhatsApp</a>
        <a class="email" href="mailto:ventas@mitienda.com">Email</a>
      </div>
    </div>

    <!-- Producto 2 -->
    <div class="producto">
      <img src="alarma2.jpg" alt="Kit avanzado de alarmas">
      <div class="info">
        <h3>Kit Avanzado</h3>
        <p>Incluye sensores para puertas, ventanas y cámara de seguridad.</p>
        <div class="precio">$250</div>
        <a class="whatsapp" href="https://wa.me/5491112345678" target="_blank">WhatsApp</a>
        <a class="email" href="mailto:ventas@mitienda.com">Email</a>
      </div>
    </div>
  </section>
  <main id="catalogo" class="max-w-7xl mx-auto p-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pt-24"></main>

<script>
/* ===================== CONFIG ===================== */
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRkMjpmwhaQZ3ZIbdHQt8bxM9oM2KmlzaEKeMi-N7Ct8GyzClX68YiP03F_myzpfi86BtPgqw9neTgb/pub?gid=541804413&single=true&output=csv";

/* ===================== HELPERS ===================== */
function parseNumber(s){
  if (s === null || s === undefined) return 0;
  if (typeof s === 'number') return s;
  let t = String(s).trim();
  t = t.replace(/\s/g, '').replace(/\./g,'').replace(/,/g,'.'); // "1.234,56" -> "1234.56"
  const n = parseFloat(t);
  return isNaN(n) ? 0 : n;
}
function cleanUrl(raw){
  if (!raw && raw !== 0) return "";
  let s = String(raw).trim();
  s = s.replace(/^href\s*=\s*/i, '');
  s = s.replace(/[“”]/g, '"');
  s = s.replace(/^"+|"+$/g, '');
  return s.trim();
}
function capitalizeDisplay(text){
  if (!text) return "";
  text = String(text).trim();
  return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();
}

/* Normaliza y extrae los campos que usamos (tolerante con nombres de columna) */
function normalizeRow(rawRow){
  // rawRow: objeto { "MODELO": "XVR...", "MARCA": "DAHUA", ... } pero keys pueden variar.
  const map = {};
  Object.keys(rawRow).forEach(k => {
    map[k.trim().toLowerCase()] = rawRow[k];
  });

  const modelo = map['modelo'] || map['producto'] || map['product'] || map['model'] || "";
  const marca = map['marca'] || map['brand'] || "";
  const tipo  = map['tipo'] || map['tipo_producto'] || map['category'] || map['tipo producto'] || "";
  const descripcion = map['descripcion'] || map['description'] || map['descr'] || "";
  const precioUsdRaw = map['precio_usd'] || map['precio usd'] || map['usd'] || map['precio'] || "";
  const precioArsRaw = map['precio_ars'] || map['precio ars'] || map['ars'] || "";
  const fichaRaw = map['ficha_link'] || map['ficha link'] || map['ficha'] || map['url_ficha'] || map['url ficha'] || "";
  const imagenRaw = map['imagen_link'] || map['imagen link'] || map['imagen'] || map['url_imagen'] || map['url imagen'] || map['image'] || "";

  return {
    PRODUCTO: String(modelo || "").trim(),
    MARCA: String(marca || "").trim(),
    TIPO_PRODUCTO: String(tipo || "").trim(),
    DESCRIPCION: String(descripcion || "").trim(),
    PRECIO_USD: parseNumber(precioUsdRaw),
    PRECIO_ARS: parseNumber(precioArsRaw),
    URL_FICHA: cleanUrl(fichaRaw),
    URL_IMAGEN: cleanUrl(imagenRaw)
  };
}

/* ===================== UI & LÓGICA ===================== */
const catalogo = document.getElementById("catalogo");
const searchInput = document.getElementById("searchInput");
const menuMarcas = document.getElementById("menuMarcas");
const btnMarcas = document.getElementById("btnMarcas");

let productosData = [];      // array completo de productos (objetos normalizados)
let marcaSeleccionada = null; // string en minúsculas

const formatUSD = new Intl.NumberFormat("en-US", { style: "currency", currency: "USD" });
const formatARS = new Intl.NumberFormat("es-AR", { style: "currency", currency: "ARS" });

function renderProductos(lista){
  catalogo.innerHTML = "";
  if (!lista || lista.length === 0) {
    catalogo.innerHTML = "<p class='col-span-full text-center text-gray-500'>No se encontraron productos.</p>";
    return;
  }
  lista.forEach(p => {
    const card = document.createElement("div");
    card.className = "producto bg-white rounded-2xl shadow-md p-4 flex flex-col";
    card.innerHTML = `
      <img src="${p.URL_IMAGEN || 'https://via.placeholder.com/300x180?text=No+image'}" alt="${escapeHtml(p.PRODUCTO)}" class="rounded-lg mb-3 mx-auto">
      <h2 class="text-lg font-bold text-red-800">${escapeHtml(p.PRODUCTO)}</h2>
      <p class="text-sm text-gray-800 font-medium">${escapeHtml(p.TIPO_PRODUCTO)}</p>
      <span class="my-2 text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded self-start">
        ${escapeHtml(p.MARCA)}
      </span>
      <p class="text-gray-600 text-sm flex-grow">${escapeHtml(p.DESCRIPCION)}</p>
      <p class="text-green-700 font-semibold mt-2">${formatUSD.format(p.PRECIO_USD)}</p>
      <p class="text-blue-700 font-semibold">${formatARS.format(p.PRECIO_ARS)}</p>
      <a href="${p.URL_FICHA || '#'}" target="_blank" class="mt-3 inline-block text-center bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">
        Ver Ficha Técnica
      </a>
    `;
    catalogo.appendChild(card);
  });
}

function escapeHtml(text){
  if (text === null || text === undefined) return "";
  return String(text)
    .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
    .replaceAll('"','&quot;').replaceAll("'",'&#39;');
}

function aplicarFiltros(){
  const texto = (searchInput.value || "").trim().toLowerCase();
  let lista = productosData;

  if (marcaSeleccionada) {
    lista = lista.filter(p => (p.MARCA || "").toLowerCase() === marcaSeleccionada);
  }
  if (texto) {
    lista = lista.filter(p =>
      (p.PRODUCTO && p.PRODUCTO.toLowerCase().includes(texto)) ||
      (p.MARCA && p.MARCA.toLowerCase().includes(texto)) ||
      (p.TIPO_PRODUCTO && p.TIPO_PRODUCTO.toLowerCase().includes(texto)) ||
      (p.DESCRIPCION && p.DESCRIPCION.toLowerCase().includes(texto))
    );
  }
  renderProductos(lista);
}

/* Construye menú dinámico de marcas */
function construirMenuMarcas(){
  menuMarcas.innerHTML = "";
  const marcas = [...new Set(productosData.map(p => (p.MARCA || "").trim().toLowerCase()).filter(Boolean))].sort();
  // opción Todas
  const optTodas = document.createElement("a");
  optTodas.href = "#";
  optTodas.textContent = "Todas los productos";
  optTodas.className = "block px-4 py-2 hover:bg-gray-800";
  optTodas.addEventListener("click", e => {
    e.preventDefault();
    marcaSeleccionada = null;
    aplicarFiltros();
    cerrarMenuMarcas();
  });
  menuMarcas.appendChild(optTodas);
  menuMarcas.appendChild(document.createElement("hr"));
  marcas.forEach(m => {
    const a = document.createElement("a");
    a.href = "#";
    a.textContent = capitalizeDisplay(m);
    a.dataset.marca = m;
    a.className = "block px-4 py-2 hover:bg-gray-800";
    a.addEventListener("click", e => {
      e.preventDefault();
      marcaSeleccionada = e.currentTarget.dataset.marca;
      aplicarFiltros();
      cerrarMenuMarcas();
    });
    menuMarcas.appendChild(a);
  });

  // debug
  console.log("Marcas únicas encontradas:", marcas.length, marcas);
}

/* controls para dropdown (toggle) */
function toggleMenuMarcas(){
  menuMarcas.classList.toggle("hidden");
}
function cerrarMenuMarcas(){
  if (!menuMarcas.classList.contains("hidden")) menuMarcas.classList.add("hidden");
}

btnMarcas.addEventListener("click", (e) => {
  e.stopPropagation();
  toggleMenuMarcas();
});

// cerrar al click fuera
document.addEventListener("click", (e) => {
  if (!menuMarcas.contains(e.target) && e.target !== btnMarcas) cerrarMenuMarcas();
});

// buscador
searchInput.addEventListener("input", aplicarFiltros);

/* ===================== CARGA CSV (PapaParse) ===================== */
function cargarCSVConPapa(){
  Papa.parse(CSV_URL, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      console.log("CSV descargado. Filas crudas:", results.data.length);
      // Normalizar filas y filtrar vacías
      const filasNorm = results.data.map(normalizeRow).filter(r => r.PRODUCTO || r.MARCA || r.DESCRIPCION);
      productosData = filasNorm;
      console.log("Productos válidos tras normalización:", productosData.length);
      construirMenuMarcas();
      aplicarFiltros();
    },
    error: function(err) {
      console.error("Error al descargar/parsear CSV:", err);
      catalogo.innerHTML = "<p class='col-span-full text-center text-red-600'>Error al cargar catálogo. Ver consola para más detalles.</p>";
    }
  });
}

/* Ejecutar carga */
cargarCSVConPapa();
</script>





  

  <!-- Footer -->
  <footer>
    © 2025 Mi Tienda de Alarmas - Todos los derechos reservados
  </footer>
<script>
  function toggleMenu() {
    document.querySelector('.menu').classList.toggle('show');
  }
</script>

</body>
</html>
