<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catálogo de Productos</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-white">

  <!-- Menú -->
  <nav class="bg-black p-4 flex">
    <div class="relative group">
      <button class="hover:bg-gray-800 px-3 py-2 rounded">Filtrar por Marca ▾</button>
      <div id="marcaMenu" class="submenu-desktop absolute left-0 top-full w-56 bg-black rounded shadow-lg z-50 hidden group-hover:block">
        <!-- Aquí se llenan las marcas dinámicamente -->
      </div>
    </div>
  </nav>

  <!-- Contenedor de productos -->
  <div id="productos" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 p-6"></div>

  <script>
    const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRkMjpmwhaQZ3ZIbdHQt8bxM9oM2KmlzaEKeMi-N7Ct8GyzClX68YiP03F_myzpfi86BtPgqw9neTgb/pub?gid=541804413&single=true&output=csv";

    let productos = [];

    async function cargarDatos() {
      const response = await fetch(url);
      const data = await response.text();
      const rows = data.split("\n").map(row => row.split(","));

      const headers = rows[0];
      productos = rows.slice(1).map(row => {
        let obj = {};
        headers.forEach((h, i) => obj[h.trim()] = row[i] ? row[i].trim() : "");
        return obj;
      });

      mostrarProductos(productos);
      generarMenuMarcas(productos);
    }

    function mostrarProductos(lista) {
      const contenedor = document.getElementById("productos");
      contenedor.innerHTML = "";
      lista.forEach(p => {
        contenedor.innerHTML += `
          <div class="bg-white text-black rounded-lg shadow p-4">
            <h3 class="font-bold text-lg">${p.MARCA}</h3>
            <p class="text-sm text-gray-600">${p.TIPO}</p>
            <p class="mt-2 font-semibold">${p.MODELO}</p>
            <p class="text-gray-700">${p.DESCRIPCION}</p>
            <p class="mt-2 text-green-700">USD ${p.PRECIO_USD}</p>
            <p class="text-blue-700">ARS ${p.PRECIO_ARS}</p>
            ${p.Ficha_Link ? `<a href="${p.Ficha_Link}" target="_blank" class="text-blue-500 underline">Ficha</a>` : ""}
            ${p.Imagen_Link ? `<img src="${p.Imagen_Link}" alt="Imagen" class="mt-2 w-full h-32 object-contain">` : ""}
          </div>
        `;
      });
    }

    function generarMenuMarcas(lista) {
      const menu = document.getElementById("marcaMenu");
      menu.innerHTML = "";

      // --- Opción para resetear filtro ---
      const opcionTodos = document.createElement("a");
      opcionTodos.href = "#";
      opcionTodos.textContent = "Todos los productos";
      opcionTodos.className = "block px-4 py-2 hover:bg-gray-800";
      opcionTodos.onclick = () => mostrarProductos(productos);
      menu.appendChild(opcionTodos);

      // --- Marcas únicas ---
      const marcas = [...new Set(lista.map(p => p.MARCA.toLowerCase()))]
        .sort()
        .map(m => m.charAt(0).toUpperCase() + m.slice(1));

      marcas.forEach(marca => {
        const link = document.createElement("a");
        link.href = "#";
        link.textContent = marca;
        link.className = "block px-4 py-2 hover:bg-gray-800";
        link.onclick = () => {
          const filtrados = productos.filter(p => p.MARCA.toLowerCase() === marca.toLowerCase());
          mostrarProductos(filtrados);
        };
        
        menu.appendChild(link);
      });
    }

    cargarDatos();
  </script>

</body>
</html>
