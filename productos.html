<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo TecnoFull DC</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hidden { display: none; }
  </style>
</head>
<body class="bg-white text-gray-900 font-sans">

  <!-- HEADER -->
<nav class="bg-black text-white fixed top-0 w-full z-50 shadow-md">
  <div class="bg-red-700 text-white p-1 text-center">
    <!-- franja superior -->
  </div>
  <div class="max-w-6xl mx-auto px-4 flex justify-between items-center py-3">
    
    <!-- Logo -->
    <div class="flex-shrink-0 mr-6">
      <a href="#" class="text-white text-lg font-bold">TecnoFull DC</a>
    </div>

    <!-- Menú -->
    <div class="hidden md:flex space-x-6 items-center">
      <a href="#" class="hover:bg-black px-3 py-2 rounded">Inicio</a>

      <!-- Dropdown Productos -->
      <div class="relative group">
        <button class="hover:bg-black px-3 py-2 rounded">Marcas ▾</button>
        <div id="menuMarcas" class="submenu-desktop absolute left-0 top-full w-56 bg-black rounded shadow-lg z-50 hidden group-hover:block">
          <!-- Aquí se cargarán las marcas dinámicamente -->
        </div>
      </div>

      <a href="#" class="hover:bg-black px-3 py-2 rounded">Quiénes Somos</a>
      <a href="#" class="hover:bg-black px-3 py-2 rounded">Contacto</a>
    </div>

    <!-- Buscador -->
    <input id="searchInput" type="text" 
      placeholder="Buscar productos..." 
      class="w-48 md:w-64 p-2 rounded border text-black">
  </div>
  <div class="bg-red-700 text-white p-1 text-center">
    <!-- franja inferior -->
  </div>
</nav>

<!-- MAIN -->
<main id="catalogo" 
  class="max-w-7xl mx-auto p-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pt-24">
</main>

<script>
  const catalogo = document.getElementById("catalogo");
  const searchInput = document.getElementById("searchInput");
  const menuMarcas = document.getElementById("menuMarcas");

  let productosData = [];
  let marcaSeleccionada = null;

  // Formateadores de moneda
  const formatUSD = new Intl.NumberFormat("en-US", { 
    style: "currency", 
    currency: "USD", 
    currencyDisplay: "code",
    minimumFractionDigits: 2, 
    maximumFractionDigits: 2 
  });

  const formatARS = new Intl.NumberFormat("es-AR", { 
    style: "currency", 
    currency: "ARS", 
    currencyDisplay: "code",
    minimumFractionDigits: 2, 
    maximumFractionDigits: 2 
  });

  // Renderizar productos
  function renderProductos(lista) {
    catalogo.innerHTML = ""; 
    lista.forEach(p => {
      const card = document.createElement("div");
      card.className = "producto bg-white rounded-2xl shadow-md p-4 flex flex-col";

      card.innerHTML = `
        <img src="${p.URL_IMAGEN}" alt="${p.PRODUCTO}" 
             class="rounded-lg mb-3 mx-auto">
        <h2 class="text-lg font-bold text-red-800">${p.PRODUCTO}</h2>
        <p class="text-lg font-bold text-gray-800">${p.TIPO_PRODUCTO}</p>
        <span class="my-2 text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded self-start">
          ${p.MARCA}
        </span>
        <p class="text-gray-600 text-sm flex-grow">${p.DESCRIPCION}</p>
        <p class="text-green-700 font-semibold mt-2">${formatUSD.format(p.PRECIO_USD)}</p>
        <p class="text-blue-700 font-semibold">${formatARS.format(p.PRECIO_ARS)}</p>
        <a href="${p.URL_FICHA}" target="_blank"
           class="mt-3 inline-block text-center bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">
          Ver Ficha Técnica
        </a>
      `;
      catalogo.appendChild(card);
    });
  }

  // Aplicar búsqueda y filtro de marca
  function aplicarFiltros() {
    const texto = searchInput.value.toLowerCase();
    let filtrados = productosData;

    if (marcaSeleccionada) {
      filtrados = filtrados.filter(p => 
        (p.MARCA || "").toLowerCase() === marcaSeleccionada.toLowerCase()
      );
    }

    if (texto) {
      filtrados = filtrados.filter(p =>
        (p.PRODUCTO && p.PRODUCTO.toLowerCase().includes(texto)) ||
        (p.MARCA && p.MARCA.toLowerCase().includes(texto)) ||
        (p.TIPO_PRODUCTO && p.TIPO_PRODUCTO.toLowerCase().includes(texto)) ||
        (p.DESCRIPCION && p.DESCRIPCION.toLowerCase().includes(texto))
      );
    }

    renderProductos(filtrados);
  }

  // Evento buscador
  searchInput.addEventListener("input", aplicarFiltros);

  // Construir menú de marcas dinámicamente
  function construirMenuMarcas() {
    const marcas = [...new Set(productosData.map(p => (p.MARCA || "").trim().toLowerCase()))];
    marcas.sort();

    // Opción "Todas las marcas"
    const opcionTodas = document.createElement("a");
    opcionTodas.href = "#";
    opcionTodas.textContent = "Todas las marcas";
    opcionTodas.className = "block px-4 py-2 hover:bg-gray-800";
    opcionTodas.addEventListener("click", e => {
      e.preventDefault();
      marcaSeleccionada = null;
      aplicarFiltros();
    });
    menuMarcas.appendChild(opcionTodas);

    // Marcas únicas
    marcas.forEach(marca => {
      if (!marca) return; // evitar vacíos
      const a = document.createElement("a");
      a.href = "#";
      a.textContent = marca.charAt(0).toUpperCase() + marca.slice(1);
      a.className = "block px-4 py-2 hover:bg-gray-800";
      a.addEventListener("click", e => {
        e.preventDefault();
        marcaSeleccionada = marca;
        aplicarFiltros();
      });
      menuMarcas.appendChild(a);
    });
  }

  // Cargar CSV de Google Sheets
  const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRkMjpmwhaQZ3ZIbdHQt8bxM9oM2KmlzaEKeMi-N7Ct8GyzClX68YiP03F_myzpfi86BtPgqw9neTgb/pub?gid=541804413&single=true&output=csv";

  async function cargarDatos() {
    const resp = await fetch(url);
    const csv = await resp.text();
    const filas = csv.split("\n").map(f => f.split(","));

    const encabezados = filas[0].map(h => h.trim());
    const productos = filas.slice(1).map(fila => {
      let obj = {};
      encabezados.forEach((h, i) => {
        obj[h] = fila[i] ? fila[i].trim() : "";
      });
      return obj;
    });

    productosData = productos;
    construirMenuMarcas();
    renderProductos(productosData);
  }

  cargarDatos();
</script>

</body>
</html>
